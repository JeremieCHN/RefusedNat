# RefusedNat
在之前的[StunTrain]("https://github.com/JeremieCHN/StunTrain")中遇到的一种NAT类型，而且这种类型并没有被RFC 3489收录，在整理明白其中原理之后，自己做一个简单的模拟
## 原理
- 维护的映射表项包括：
    - 内网端口号
    - WAN口端口号
    - 可通行外网端口
    - 拒绝通行外网端口
- 表项形成过程：
    - 内网对外发包
        - 若此时没有任何端口号提供给了这个内网端口，则形成一个新表项，并将这个包的目的外网端口记入可通行外网端口
        - 若此时有端口号提供给了这个内网端口，则检查是否在拒绝通行外网端口的列表中。不在则转发，并将这个包的目的外网端口记入可通行外网端口；在则分配新的端口号
    - 外网对内发包
        - 若WAN口端口号未被分配，拒绝转发
        - 若WAN口端口号已被分配，则检查是否在可通行外网端口列表中，在则转发，不在则拒绝并记入拒绝通行外网端口列表
- 简单总结
    1. &emsp;可通行外网端口列表只能由内网端口来添加，并在收到外网数据包时使用
    2. 拒绝通行外网端口列表只能由外网端口来添加，并在收到内网数据包时使用
    3. 最终效果是可以一个内网端口被分配了多个外网端口
    4. 和其他类型一样，会有过期时间和端口分配顺序（恒等型、等差型）